---
title: æŸ¥è¯¢å‚æ•°å¤„ç†
---

# æŸ¥è¯¢å‚æ•°å¤„ç†

åœ¨è·¯ç”±è·³è½¬è¿‡ç¨‹ä¸­,ç»å¸¸éœ€è¦é€šè¿‡ URL æŸ¥è¯¢å‚æ•°(Query String)ä¼ é€’æ•°æ®ã€‚æœ¬æ¡†æ¶æä¾›äº†ä¸€å¥—å®Œæ•´çš„æŸ¥è¯¢å‚æ•°è§£æå’Œåºåˆ—åŒ–å·¥å…·å‡½æ•°,ä½¿å¾—å¤„ç† URL æŸ¥è¯¢å‚æ•°å˜å¾—ç®€å•é«˜æ•ˆã€‚

## æ¦‚è¿°

æŸ¥è¯¢å‚æ•°å¤„ç†æ¨¡å—æä¾›äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½:

- **parseQuery**: å°† URL æŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡
- **stringifyQuery**: å°†å¯¹è±¡åºåˆ—åŒ–ä¸º URL æŸ¥è¯¢å­—ç¬¦ä¸²
- **encode/decode**: æä¾›å®‰å…¨çš„ç¼–ç å’Œè§£ç åŠŸèƒ½

## ç±»å‹å®šä¹‰

```ts
// å•ä¸ªæŸ¥è¯¢å‚æ•°å€¼ç±»å‹
export type LocationQueryValue = string | null;

// æŸ¥è¯¢å‚æ•°å¯¹è±¡ç±»å‹
export type LocationQuery = Record<string, LocationQueryValue | LocationQueryValue[]>;

// åŸå§‹æŸ¥è¯¢å‚æ•°å€¼ç±»å‹(åºåˆ—åŒ–å‰)
export type LocationQueryValueRaw = LocationQueryValue | number | undefined;

// åŸå§‹æŸ¥è¯¢å‚æ•°å¯¹è±¡ç±»å‹(åºåˆ—åŒ–å‰)
export type LocationQueryRaw = Record<string | number, LocationQueryValueRaw | LocationQueryValueRaw[]>;
```

## parseQuery - è§£ææŸ¥è¯¢å­—ç¬¦ä¸²

### å‡½æ•°ç­¾å

```ts
export function parseQuery(search: string): LocationQuery
```

### åŠŸèƒ½è¯´æ˜

å°† URL æŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºé”®å€¼å¯¹è±¡,æ”¯æŒ:

- è‡ªåŠ¨å¤„ç†å‰å¯¼ `?` ç¬¦å·
- æ”¯æŒæ•°ç»„å‚æ•°(åŒåå‚æ•°ä¼šåˆå¹¶ä¸ºæ•°ç»„)
- è‡ªåŠ¨è§£ç  URL ç¼–ç çš„å­—ç¬¦
- å¤„ç†ç©ºå€¼å‚æ•°

### ä½¿ç”¨ç¤ºä¾‹

```ts
import { parseQuery } from '@/features/router/query';

// åŸºç¡€ç”¨æ³•
const query1 = parseQuery('?page=1&size=10');
// ç»“æœ: { page: '1', size: '10' }

// æ— å‰å¯¼é—®å·
const query2 = parseQuery('name=John&age=25');
// ç»“æœ: { name: 'John', age: '25' }

// æ•°ç»„å‚æ•°(åŒåå‚æ•°)
const query3 = parseQuery('?tag=React&tag=TypeScript&tag=Vite');
// ç»“æœ: { tag: ['React', 'TypeScript', 'Vite'] }

// ç©ºå€¼å‚æ•°
const query4 = parseQuery('?filter=&sort=desc');
// ç»“æœ: { filter: null, sort: 'desc' }

// åŒ…å«ç‰¹æ®Šå­—ç¬¦
const query5 = parseQuery('?message=Hello%20World&emoji=%F0%9F%98%80');
// ç»“æœ: { message: 'Hello World', emoji: 'ğŸ˜€' }

// ç©ºå­—ç¬¦ä¸²
const query6 = parseQuery('');
// ç»“æœ: {}
```

### ç‰¹æ®Šå¤„ç†

#### 1. åŠ å·è½¬æ¢ä¸ºç©ºæ ¼

URL ä¸­çš„ `+` ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºç©ºæ ¼:

```ts
parseQuery('?name=John+Doe');
// ç»“æœ: { name: 'John Doe' }
```

#### 2. æ•°ç»„å‚æ•°åˆå¹¶

åŒåå‚æ•°ä¼šè‡ªåŠ¨åˆå¹¶ä¸ºæ•°ç»„:

```ts
parseQuery('?id=1&id=2&id=3');
// ç»“æœ: { id: ['1', '2', '3'] }
```

#### 3. æ— å€¼å‚æ•°

æ²¡æœ‰ç­‰å·çš„å‚æ•°,å€¼ä¸º `null`:

```ts
parseQuery('?debug&verbose');
// ç»“æœ: { debug: null, verbose: null }
```

## stringifyQuery - åºåˆ—åŒ–æŸ¥è¯¢å¯¹è±¡

### å‡½æ•°ç­¾å

```ts
export function stringifyQuery(query: LocationQueryRaw): string
```

### åŠŸèƒ½è¯´æ˜

å°†æŸ¥è¯¢å‚æ•°å¯¹è±¡åºåˆ—åŒ–ä¸º URL æŸ¥è¯¢å­—ç¬¦ä¸²,æ”¯æŒ:

- è‡ªåŠ¨ç¼–ç ç‰¹æ®Šå­—ç¬¦
- å¤„ç†æ•°ç»„å‚æ•°
- è¿‡æ»¤ `undefined` å€¼
- å¤„ç† `null` å€¼(åªè¾“å‡ºé”®å,æ— ç­‰å·)

### ä½¿ç”¨ç¤ºä¾‹

```ts
import { stringifyQuery } from '@/features/router/query';

// åŸºç¡€ç”¨æ³•
const search1 = stringifyQuery({ page: 1, size: 10 });
// ç»“æœ: 'page=1&size=10'

// æ•°ç»„å‚æ•°
const search2 = stringifyQuery({ tags: ['React', 'Vue', 'Angular'] });
// ç»“æœ: 'tags=React&tags=Vue&tags=Angular'

// åŒ…å«ç‰¹æ®Šå­—ç¬¦
const search3 = stringifyQuery({ message: 'Hello World', emoji: 'ğŸ˜€' });
// ç»“æœ: 'message=Hello+World&emoji=%F0%9F%98%80'

// null å€¼(åªè¾“å‡ºé”®å)
const search4 = stringifyQuery({ filter: null, sort: 'desc' });
// ç»“æœ: 'filter&sort=desc'

// undefined å€¼ä¼šè¢«å¿½ç•¥
const search5 = stringifyQuery({ page: 1, temp: undefined });
// ç»“æœ: 'page=1'

// ç©ºå¯¹è±¡
const search6 = stringifyQuery({});
// ç»“æœ: ''
```

### ç‰¹æ®Šå¤„ç†

#### 1. æ•°ç»„å‚æ•°

æ•°ç»„ä¼šè¢«å±•å¼€ä¸ºå¤šä¸ªåŒåå‚æ•°:

```ts
stringifyQuery({ colors: ['red', 'green', 'blue'] });
// ç»“æœ: 'colors=red&colors=green&colors=blue'
```

#### 2. null vs undefined

- `null`: è¾“å‡ºé”®å,ä¸è¾“å‡ºç­‰å·å’Œå€¼
- `undefined`: å®Œå…¨å¿½ç•¥,ä¸è¾“å‡º

```ts
stringifyQuery({ a: null, b: undefined, c: '' });
// ç»“æœ: 'a&c='
```

#### 3. ç©ºæ ¼ç¼–ç 

ç©ºæ ¼ä¼šè¢«ç¼–ç ä¸º `+` è€Œä¸æ˜¯ `%20`:

```ts
stringifyQuery({ name: 'John Doe' });
// ç»“æœ: 'name=John+Doe'
```

## encode/decode - ç¼–è§£ç å·¥å…·

### decode - è§£ç å­—ç¬¦ä¸²

```ts
export function decode(text: string | number): string
```

å®‰å…¨åœ°è§£ç  URL ç¼–ç çš„å­—ç¬¦ä¸²,å¦‚æœè§£ç å¤±è´¥ä¼šè¿”å›åŸå§‹å€¼å¹¶è¾“å‡ºè­¦å‘Š:

```ts
decode('Hello%20World');  // 'Hello World'
decode('%E4%B8%AD%E6%96%87');  // 'ä¸­æ–‡'
decode('invalid%');  // 'invalid%' (è§£ç å¤±è´¥,è¿”å›åŸå€¼)
```

### encodeQueryKey - ç¼–ç æŸ¥è¯¢å‚æ•°é”®

```ts
export function encodeQueryKey(text: string | number): string
```

ç¼–ç æŸ¥è¯¢å‚æ•°çš„é”®å,ä¼šå¯¹ `=` ç¬¦å·è¿›è¡Œç‰¹æ®Šå¤„ç†:

```ts
encodeQueryKey('user[name]');  // 'user[name]'
encodeQueryKey('key=value');   // 'key%3Dvalue'
```

### encodeQueryValue - ç¼–ç æŸ¥è¯¢å‚æ•°å€¼

```ts
export function encodeQueryValue(text: string | number): string
```

ç¼–ç æŸ¥è¯¢å‚æ•°çš„å€¼,å¤„ç†å„ç§ç‰¹æ®Šå­—ç¬¦:

```ts
encodeQueryValue('Hello World');  // 'Hello+World'
encodeQueryValue('a&b=c');        // 'a%26b%3Dc'
encodeQueryValue('emoji ğŸ˜€');     // 'emoji+%F0%9F%98%80'
```

## åœ¨è·¯ç”±ä¸­ä½¿ç”¨

### 1. åœ¨ useRoute ä¸­è·å–æŸ¥è¯¢å‚æ•°

```tsx
import { useRoute } from '@/features/router';

function MyComponent() {
  const route = useRoute<any, { page: string; size: string }>();

  console.log(route.query.page);  // '1'
  console.log(route.query.size);  // '10'

  return <div>Page: {route.query.page}</div>;
}
```

### 2. åœ¨ useRouter ä¸­ä½¿ç”¨æŸ¥è¯¢å‚æ•°

```tsx
import { useRouter } from '@/features/router';

function MyComponent() {
  const router = useRouter();

  // æ–¹æ³•1: ä½¿ç”¨ push æ–¹æ³•çš„ query é€‰é¡¹
  const handleNavigate = () => {
    router.push('/users', {
      query: { page: 1, size: 10, tags: ['React', 'TypeScript'] }
    });
    // è·³è½¬åˆ°: /users?page=1&size=10&tags=React&tags=TypeScript
  };

  // æ–¹æ³•2: æ‰‹åŠ¨æ‹¼æ¥æŸ¥è¯¢å­—ç¬¦ä¸²
  const handleNavigate2 = () => {
    router.push('/users?page=1&size=10');
  };

  return (
    <div>
      <button onClick={handleNavigate}>Navigate with query</button>
    </div>
  );
}
```

### 3. ä½¿ç”¨ goTo æ–¹æ³•

```tsx
const router = useRouter();

// å¸¦æŸ¥è¯¢å‚æ•°è·³è½¬
router.goTo('/products', {
  query: {
    category: 'electronics',
    sort: 'price',
    order: 'asc'
  }
});
// è·³è½¬åˆ°: /products?category=electronics&sort=price&order=asc
```

## å®é™…åº”ç”¨åœºæ™¯

### 1. åˆ†é¡µå‚æ•°

```tsx
function ProductList() {
  const route = useRoute<any, { page: string; size: string }>();
  const router = useRouter();

  const currentPage = parseInt(route.query.page || '1');
  const pageSize = parseInt(route.query.size || '10');

  const handlePageChange = (newPage: number) => {
    router.push('/products', {
      query: { page: newPage, size: pageSize }
    });
  };

  return (
    <div>
      <ProductGrid page={currentPage} size={pageSize} />
      <Pagination current={currentPage} onChange={handlePageChange} />
    </div>
  );
}
```

### 2. æœç´¢è¿‡æ»¤

```tsx
function SearchPage() {
  const route = useRoute<any, { q: string; category: string; tags: string[] }>();
  const router = useRouter();

  const handleSearch = (keyword: string, filters: any) => {
    router.push('/search', {
      query: {
        q: keyword,
        category: filters.category,
        tags: filters.tags,
        minPrice: filters.minPrice,
        maxPrice: filters.maxPrice
      }
    });
  };

  return (
    <div>
      <SearchInput onSearch={handleSearch} />
      <SearchResults query={route.query.q} filters={route.query} />
    </div>
  );
}
```

### 3. Tab åˆ‡æ¢

```tsx
function DashboardPage() {
  const route = useRoute<any, { tab: string }>();
  const router = useRouter();

  const activeTab = route.query.tab || 'overview';

  const handleTabChange = (newTab: string) => {
    router.replace('/dashboard', {
      query: { tab: newTab }
    });
  };

  return (
    <div>
      <Tabs value={activeTab} onChange={handleTabChange}>
        <Tab value="overview">æ¦‚è§ˆ</Tab>
        <Tab value="analytics">åˆ†æ</Tab>
        <Tab value="reports">æŠ¥è¡¨</Tab>
      </Tabs>
    </div>
  );
}
```

## ç¼–ç è§„åˆ™

### ä¿ç•™å­—ç¬¦

ä»¥ä¸‹å­—ç¬¦åœ¨æŸ¥è¯¢å‚æ•°ä¸­ä¼šè¢«ç¼–ç :

| å­—ç¬¦ | ç¼–ç å | è¯´æ˜ |
|------|--------|------|
| ç©ºæ ¼ | `+` æˆ– `%20` | ä¼˜å…ˆä½¿ç”¨ `+` |
| `=` | `%3D` | ç­‰å· |
| `&` | `%26` | ä¸å· |
| `#` | `%23` | äº•å· |
| `` ` `` | `%60` | åå¼•å· |
| `{` | `%7B` | å·¦èŠ±æ‹¬å· |
| `}` | `%7D` | å³èŠ±æ‹¬å· |
| `^` | `%5E` | è„±å­—ç¬¦ |
| `|` | `%7C` | ç«–çº¿ |

### ä¸ç¼–ç å­—ç¬¦

ä»¥ä¸‹å­—ç¬¦ä¿æŒåŸæ ·,ä¸è¿›è¡Œç¼–ç :

- å­—æ¯: `a-z` `A-Z`
- æ•°å­—: `0-9`
- ç‰¹æ®Šç¬¦å·: `-` `_` `.` `~`
- æ–¹æ‹¬å·: `[` `]` (ç”¨äºæ•°ç»„å‚æ•°)

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. é¿å…é¢‘ç¹åºåˆ—åŒ–

å¦‚æœéœ€è¦å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„æŸ¥è¯¢å‚æ•°,å¯ä»¥ç¼“å­˜åºåˆ—åŒ–ç»“æœ:

```tsx
const queryString = useMemo(() => {
  return stringifyQuery({ page, size, filters });
}, [page, size, filters]);
```

### 2. åˆç†ä½¿ç”¨ replace

å¦‚æœåªæ˜¯æ›´æ–°æŸ¥è¯¢å‚æ•°,ä½¿ç”¨ `replace` è€Œä¸æ˜¯ `push` å¯ä»¥é¿å…äº§ç”Ÿè¿‡å¤šçš„å†å²è®°å½•:

```tsx
// æ¨è: ä½¿ç”¨ replace
router.replace('/list', { query: { page: 2 } });

// ä¸æ¨è: ä½¿ç”¨ push (ä¼šäº§ç”Ÿå†å²è®°å½•)
router.push('/list', { query: { page: 2 } });
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®ç±»å‹**: æŸ¥è¯¢å‚æ•°çš„å€¼å§‹ç»ˆæ˜¯å­—ç¬¦ä¸²ç±»å‹,éœ€è¦æ—¶è®°å¾—è½¬æ¢:
   ```ts
   const page = parseInt(route.query.page || '1');
   const enabled = route.query.enabled === 'true';
   ```

2. **ç‰¹æ®Šå­—ç¬¦**: åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å€¼ä¼šè¢«è‡ªåŠ¨ç¼–ç ,ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†

3. **æ•°ç»„å‚æ•°**: æ•°ç»„å‚æ•°ä¼šå±•å¼€ä¸ºå¤šä¸ªåŒåå‚æ•°,è€Œä¸æ˜¯ JSON å­—ç¬¦ä¸²

4. **undefined vs null**: `undefined` ä¼šè¢«å¿½ç•¥,`null` ä¼šè¾“å‡ºé”®å

## ç›¸å…³æ–‡ä»¶

- **query.ts**: æŸ¥è¯¢å‚æ•°å¤„ç†å·¥å…· (`/src/features/router/query.ts:1`)
- **useRoute.ts**: è·å–è·¯ç”±ä¿¡æ¯çš„ Hook (`/src/features/router/useRoute.ts:1`)
- **router.ts**: æ ¸å¿ƒè·¯ç”±å®ä¾‹ (`/src/features/router/router.ts:1`)

## æ€»ç»“

æŸ¥è¯¢å‚æ•°å¤„ç†æ¨¡å—æä¾›äº†å®Œæ•´çš„è§£æå’Œåºåˆ—åŒ–åŠŸèƒ½,ä½¿å¾—å¤„ç† URL æŸ¥è¯¢å‚æ•°å˜å¾—ç®€å•å¯é :

- `parseQuery` å°†æŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡
- `stringifyQuery` å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²
- è‡ªåŠ¨å¤„ç†ç¼–ç /è§£ç ã€æ•°ç»„å‚æ•°ç­‰å¤æ‚æƒ…å†µ
- ä¸ `useRoute` å’Œ `useRouter` æ— ç¼é›†æˆ
- æ”¯æŒå„ç§å®é™…åº”ç”¨åœºæ™¯
